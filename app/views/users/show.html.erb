<%= render 'shared/errors' %>

<div class="row">
  <div class="col-lg-12">
    <h1> Get Some, <%= @current_user.name.split(" ").first %> ;) </h1>
  </div>
</div>


<div class="row">
  <div class="col-lg-8">
      <%= form_tag new_order_path, method: :get do %>
      <div id='create-order' >
        <!-- on click, redirect to order new action -->
        <%= submit_tag "Create New Order", id: 'create-order-btn', class: "btn btn-default" %>
        <!-- <button id='create-order-btn'>Create New Order</button> -->

      </div>

      <div id='group-list' class="lead">
        <h3>Orders You Can Join</h3>
        <div id='group-select'>
          <h5>Select your groups</h5>
          <%= user_select_logic %>
        </div>
        <% end %>
        <br>
        <div id='group-orders'>
          <ul>
            <% @current_user.organizations.find_by(id: session[:current_org].to_i).org_sorted_recent_orders.each do |order| %>
              <% if order.order_you_can_join?(@current_user) %> <!-- comment this out for testing purposes. uncomment for production-->
                <div class='group-order' id='<%= order.id %>' organization-id='<%= order.organization_id %>' group-id='<%= order.group_id %>'>
                  <li><strong>Restaurant: <%= order.restaurant.name %></strong><br>
                  Description: <%= order.description %><br>
                  Expires In: <%= distance_of_time_in_words((order.expiration - Time.current).to_i) %> (<%= order.expiration.strftime("%b %e at %l:%M %p ") %>)<br>
                  Reached: $<%= order.item_total %> out of $<%= order.minimum_cost.to_i %> minimum needed <br>
                  Group: <%= order.group.name %>
                  <%= joinOrderButton(order) %></li><br>
                </div>
              <% end %>
            <% end %>
            </ul>
          </div>
        </div>
      </div>
      <div class="col-lg-4">
        <% unless @current_user.user_sorted_recent_orders.empty? %>
          <div id='my-orders'>
            <h3>Your Recent Orders</h3>
            <ul>
              <% @current_user.user_sorted_recent_orders.each do |order| %>
                <div class='user-order-<%= order.expired? ? 'expired' : 'active' %>' id='<%= order.id %>'>
                  <li><strong>Restaurant: <%= order.restaurant.name %></strong><br>
                    <% if order.expired? %>
                      <b>EXPIRED <%= distance_of_time_in_words((order.expiration - Time.current).to_i) %> ago</b><br>
                    <% end %>
                    Description: <%= order.description %><br>
                    <% if !order.expired? %>
                      Expires In: <%= distance_of_time_in_words((order.expiration - Time.current).to_i) %> (<%= order.expiration.strftime("%b %e at %l:%M %p ") %>)<br>
                    <% end %>
                    Reached: $<%= order.item_total %> out of $<%= order.minimum_cost.to_i %> minimum needed <br>
                    Group: <%= order.group.name %>
                    <%= joinOrderButton(order) %></li><br>
                </div>
              <% end %>
            </ul>
          </div>
        <% end %>
      <br>
      </div>

    </div>
    <script scr='users.js'></script>
